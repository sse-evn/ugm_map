<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Карта Алматы для скаутов</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <!-- Tailwind CSS через CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #map { height: calc(100vh - 4rem); width: 100%; }
    body { margin: 0; font-family: Arial, sans-serif; }
    .zone-btn { transition: background-color 0.3s; }
    .zone-btn.active { background-color: #1e40af; color: white; }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Панель управления -->
  <div class="fixed top-0 w-full bg-white shadow-md p-2 z-10">
    <div class="flex justify-around">
      <button id="workZone" class="zone-btn px-4 py-2 bg-blue-100 rounded-md text-sm font-semibold">Рабочие зоны</button>
      <button id="restZone" class="zone-btn px-4 py-2 bg-green-100 rounded-md text-sm font-semibold">Зоны отдыха</button>
      <button id="officeZone" class="zone-btn px-4 py-2 bg-yellow-100 rounded-md text-sm font-semibold">Офисы</button>
    </div>
  </div>

  <!-- Контейнер для карты -->
  <div id="map" class="mt-16"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    // Инициализация карты (центр Алматы)
    const map = L.map('map').setView([43.2389, 76.8897], 12);

    // Добавление тайлов OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      maxZoom: 18
    }).addTo(map);

    // Слои для зон
    let workLayer = L.layerGroup().addTo(map);
    let restLayer = L.layerGroup().addTo(map);
    let officeLayer = L.layerGroup().addTo(map);

    // Пример зон (полигоны для Алматы)
    const zones = {
      work: [
        {
          coords: [[43.25, 76.85], [43.25, 76.90], [43.30, 76.90], [43.30, 76.85]],
          popup: 'Рабочая зона: Центр (скауты 1-5)'
        },
        {
          coords: [[43.22, 76.92], [43.22, 76.97], [43.27, 76.97], [43.27, 76.92]],
          popup: 'Рабочая зона: Магазины'
        }
      ],
      rest: [
        {
          coords: [[43.23, 76.88], [43.23, 76.93], [43.28, 76.93], [43.28, 76.88]],
          popup: 'Зона отдыха: Парк 28 Панфиловцев'
        }
      ],
      office: [
        {
          coords: [[43.238, 76.89]], // Точка для офиса
          popup: 'Офис компании'
        }
      ]
    };

    // Функция для добавления зон
    function addZones() {
      // Очистка слоёв
      workLayer.clearLayers();
      restLayer.clearLayers();
      officeLayer.clearLayers();

      // Рабочие зоны (синие полигоны)
      zones.work.forEach(zone => {
        L.polygon(zone.coords, { color: 'blue', fillOpacity: 0.3 })
          .addTo(workLayer)
          .bindPopup(zone.popup);
      });

      // Зоны отдыха (зелёные полигоны)
      zones.rest.forEach(zone => {
        L.polygon(zone.coords, { color: 'green', fillOpacity: 0.3 })
          .addTo(restLayer)
          .bindPopup(zone.popup);
      });

      // Офисы (жёлтые маркеры)
      zones.office.forEach(zone => {
        L.marker(zone.coords, {
          icon: L.divIcon({ className: 'bg-yellow-500 rounded-full w-4 h-4' })
        }).addTo(officeLayer).bindPopup(zone.popup);
      });
    }

    // Загрузка данных из Overpass API (например, кафе)
    async function loadCafes() {
      const query = `
        [out:json];
        area[name="Almaty"]->.almaty;
        node["amenity"="cafe"](area.almaty);
        out body;
      `;
      const response = await fetch('https://overpass-api.de/api/interpreter', {
        method: 'POST',
        body: `data=${encodeURIComponent(query)}`
      });
      const data = await response.json();
      data.elements.forEach(element => {
        if (element.type === 'node') {
          L.marker([element.lat, element.lon], {
            icon: L.divIcon({ className: 'bg-red-500 rounded-full w-3 h-3' })
          }).addTo(restLayer).bindPopup(element.tags.name || 'Кафе');
        }
      });
    }

    // Инициализация зон
    addZones();
    loadCafes();

    // Управление видимостью зон
    document.getElementById('workZone').addEventListener('click', () => {
      toggleLayer(workLayer, 'workZone');
    });
    document.getElementById('restZone').addEventListener('click', () => {
      toggleLayer(restLayer, 'restZone');
    });
    document.getElementById('officeZone').addEventListener('click', () => {
      toggleLayer(officeLayer, 'officeZone');
    });

    function toggleLayer(layer, buttonId) {
      if (map.hasLayer(layer)) {
        map.removeLayer(layer);
        document.getElementById(buttonId).classList.remove('active');
      } else {
        map.addLayer(layer);
        document.getElementById(buttonId).classList.add('active');
      }
    }
  </script>
</body>
</html>